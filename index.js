var DomoEval,Sandbox,coffee,parseFlags,__bind=function(n,t){return function(){return n.apply(t,arguments)}};Sandbox=require("sandbox"),coffee=require("coffee-script"),parseFlags=function(n){var t,e,o;return o=/^-([a-z]*)\s/i,t=[],e=function(i){var r;if(null!=(r=i.match(o)))return t.push(r[1]),i=n=i.replace(o,""),e(i)},e(n),[t,n]},DomoEval=function(){function n(){this.onMessage=__bind(this.onMessage,this),this.jsEval=__bind(this.jsEval,this),this.coffeeEval=__bind(this.coffeeEval,this),this.init=__bind(this.init,this),this.match="!eval "}return n.prototype.init=function(n){this.domo=n},n.prototype.coffeeEval=function(n,t){var e;try{return t(null,coffee.compile(n,{bare:!0}).replace("\n",""))}catch(o){return e=o,t(e)}},n.prototype.jsEval=function(n,t){return(new Sandbox).run(n,function(n){return t(null,n.result)})},n.prototype.onMessage=function(n,t,e){var o,i,r=this;return i=parseFlags(e),o=i[0],e=i[1],o.indexOf("c")>-1?this.coffeeEval(e,function(n,e){return null!=n?r.domo.client.say(t,n.stack.split("\n")[0]):o.indexOf("v")>-1?r.domo.client.say(t,e):r.jsEval(e,function(n,e){return r.domo.client.say(t,e)})}):this.jsEval(e,function(n,e){return r.domo.client.say(t,e)})},n}(),module.exports=new DomoEval;